using System;
using System.Linq;
using System.Collections;
using System.Collections.Generic;
using System.IO;

using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json;

using Valeant.Sp.UprsWeb.Controllers;
using Valeant.Sp.UprsWeb.Controllers.Entities;



namespace Valeant.Sp.UprsWeb.Tests
{
    [TestClass]
    public class UnitTest1
    {
        [TestMethod]
        public void TestJSON1()
        {
            /*
{"action":"Создать","data":{"scanPdfsData":{"rows":[],"options":{}},"destinationsData":{"rows":[{"index":1,"country":{"IsForeign":false,"Name":"Россия","Id":1193},"city":{"Id":1048,"Name":"Тында","CountryId":1193},"organization":"бам","date":{"startDate":"2016-03-09T00:00:00+03:00","endDate":"2016-03-11T00:00:00+03:00"}}],"options":{"ownExpense":false}},"dailyCostsData":{"rows":[{"index":1,"date":"2016-03-08T21:00:00.000Z","city":{"CountryId":1193,"Name":"Тында","Id":1048},"dinner":false,"supper":false,"baseCost":1000,"cost":1000},{"index":2,"date":"2016-03-09T21:00:00.000Z","city":{"CountryId":1193,"Name":"Тында","Id":1048},"dinner":false,"supper":false,"baseCost":1000,"cost":1000},{"index":3,"date":"2016-03-10T21:00:00.000Z","city":{"CountryId":1193,"Name":"Тында","Id":1048},"dinner":false,"supper":false,"baseCost":1000,"cost":1000}],"options":{"entry":"2016-03-02T05:21:06.712Z","departure":"2016-03-02T05:21:06.712Z"}},"ticketRequestsData":{"rows":[{"index":1,"date":"2016-03-08T21:00:00.000Z","from":{"title":"Москва","description":{"CountryId":1193,"Name":"Москва","Id":650},"image":"","originalObject":{"CountryId":1193,"Name":"Москва","Id":650},"$$hashKey":"object:575"},"to":{"title":"Тында","description":{"CountryId":1193,"Name":"Тында","Id":1048},"image":"","originalObject":{"CountryId":1193,"Name":"Тында","Id":1048},"$$hashKey":"object:605"},"ticketDescription":"71","comment":"ПРИВЕТ!!!!!!!!!!"}],"options":{"isNeed":false}},"hotelRequestsData":{"rows":[],"options":{"isNeed":false}},"trasferRequestsData":{"rows":[],"options":{"isNeed":false}},"travelCoordinatorData":{"overLimit":false},"requestMainData":{"number":11234,"date":"2016-03-02T08:13:06+03:00","tripType":{"Name":"Служебная поездка","Id":1},"tripAim":{"Name":"Встреча с заказчиком","Id":1},"vehicle":{"Name":"Поезд","Id":2},"comment":"туту туту","person":{"Id":15,"Code":"01-000001207","FullName":"Андреев Антон Александрович","ClockNumber":"01-000000В336","Status":"active","DepartmentCode":"01-ЗП0000526","DepartmentName":"Группа по работе с корпоративными приложениями","Email":"vladimir.kovalev.mail@gmail.com","UserAccount":"test\\Anton.Andreev","AssistantId":null,"DeputyId":null,"ManagerId":45,"AssistantName":null,"DeputyName":null,"ManagerName":"Белоусова Александра Игоревна","Manager2NdName":"Феоктистов Тимофей Ильич","Manager2NdId":579,"DeputyRange":{"startDate":"0001-01-01T00:00:00+00:00","endDate":"0001-01-01T00:00:00+00:00"},"Position":"Специалист по системе управления взаимоотношениями с клиентами","Costcenter":"Отдел инфраструктуры информационных систем","DocumentIssuedBy":"Отделом внутренних дел Ленинского района города Иваново","DocumentIssuedOn":"2006-02-26T00:00:00Z","DocumentNumber":"217625","DocumentSeries":"24 05","NumberInternationalPassport":null,"ValidityInternationalPassport":null,"Organization":"ООО \"ВАЛЕАНТ\"","Country":"Россия","IsAdministrator":false,"Roles":[{"Id":1,"Name":"Сотрудник","Code":"R-00000001","IsAdministrator":false}]},"orderData":{"date":"2016-03-02T08:13:06+03:00","isApproved":false}}}}
             */
            //            string json = "{\"action\":\"Создать\",\"data\":{\"scanPdfsData\":{\"rows\":[],\"options\":{}},\"destinationsData\":{\"rows\":[{\"index\":1,\"country\":{\"IsForeign\":false,\"Name\":\"Россия\",\"Id\":1193},\"city\":{\"Id\":1048,\"Name\":\"Тында\",\"CountryId\":1193},\"organization\":\"бам\",\"date\":{\"startDate\":\"2016-03-09T00:00:00+03:00\",\"endDate\":\"2016-03-11T00:00:00+03:00\"}}],\"options\":{\"ownExpense\":false}},\"dailyCostsData\":{\"rows\":[{\"index\":1,\"date\":\"2016-03-08T21:00:00.000Z\",\"city\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000},{\"index\":2,\"date\":\"2016-03-09T21:00:00.000Z\",\"city\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000},{\"index\":3,\"date\":\"2016-03-10T21:00:00.000Z\",\"city\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000}],\"options\":{\"entry\":\"2016-03-02T05:21:06.712Z\",\"departure\":\"2016-03-02T05:21:06.712Z\"}},\"ticketRequestsData\":{\"rows\":[{\"index\":1,\"date\":\"2016-03-08T21:00:00.000Z\",\"from\":{\"title\":\"Москва\",\"description\":{\"CountryId\":1193,\"Name\":\"Москва\",\"Id\":650},\"image\":\"\",\"originalObject\":{\"CountryId\":1193,\"Name\":\"Москва\",\"Id\":650},\"$$hashKey\":\"object:575\"},\"to\":{\"title\":\"Тында\",\"description\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"image\":\"\",\"originalObject\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"$$hashKey\":\"object:605\"},\"ticketDescription\":\"71\",\"comment\":\"ПРИВЕТ!!!!!!!!!!\"}],\"options\":{\"isNeed\":false}},\"hotelRequestsData\":{\"rows\":[],\"options\":{\"isNeed\":false}},\"trasferRequestsData\":{\"rows\":[],\"options\":{\"isNeed\":false}},\"travelCoordinatorData\":{\"overLimit\":false},\"requestMainData\":{\"number\":11234,\"date\":\"2016-03-02T08:13:06+03:00\",\"tripType\":{\"Name\":\"Служебная поездка\",\"Id\":1},\"tripAim\":{\"Name\":\"Встреча с заказчиком\",\"Id\":1},\"vehicle\":{\"Name\":\"Поезд\",\"Id\":2},\"comment\":\"туту туту\",\"person\":{\"Id\":15,\"Code\":\"01-000001207\",\"FullName\":\"Андреев Антон Александрович\",\"ClockNumber\":\"01-000000В336\",\"Status\":\"active\",\"DepartmentCode\":\"01-ЗП0000526\",\"DepartmentName\":\"Группа по работе с корпоративными приложениями\",\"Email\":\"vladimir.kovalev.mail@gmail.com\",\"UserAccount\":\"test\\\\Anton.Andreev\",\"AssistantId\":null,\"DeputyId\":null,\"ManagerId\":45,\"AssistantName\":null,\"DeputyName\":null,\"ManagerName\":\"Белоусова Александра Игоревна\",\"Manager2NdName\":\"Феоктистов Тимофей Ильич\",\"Manager2NdId\":579,\"DeputyRange\":{\"startDate\":\"0001-01-01T00:00:00+00:00\",\"endDate\":\"0001-01-01T00:00:00+00:00\"},\"Position\":\"Специалист по системе управления взаимоотношениями с клиентами\",\"Costcenter\":\"Отдел инфраструктуры информационных систем\",\"DocumentIssuedBy\":\"Отделом внутренних дел Ленинского района города Иваново\",\"DocumentIssuedOn\":\"2006-02-26T00:00:00Z\",\"DocumentNumber\":\"217625\",\"DocumentSeries\":\"24 05\",\"NumberInternationalPassport\":null,\"ValidityInternationalPassport\":null,\"Organization\":\"ООО \\\"ВАЛЕАНТ\\\"\",\"Country\":\"Россия\",\"IsAdministrator\":false,\"Roles\":[{\"Id\":1,\"Name\":\"Сотрудник\",\"Code\":\"R-00000001\",\"IsAdministrator\":false}]},\"orderData\":{\"date\":\"2016-03-02T08:13:06+03:00\",\"isApproved\":false}}}}";
            //from \"title\":\"Москва\",\"description\":{\"CountryId\":1193,\"Name\":\"Москва\",\"Id\":650},\"image\":\"\",\"originalObject\":{\"CountryId\":1193,\"Name\":\"Москва\",\"Id\":650},\"hashKey\":\"object:575\"
            //to \"title\":\"Тында\",\"description\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"image\":\"\",\"originalObject\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"hashKey\":\"object:605\"

            string json = "{\"action\":\"Создать\",\"data\":{\"scanPdfsData\":{\"rows\":[],\"options\":{}},\"destinationsData\":{\"rows\":[{\"index\":1,\"country\":{\"IsForeign\":false,\"Name\":\"Россия\",\"Id\":1193},\"city\":{\"Id\":1048,\"Name\":\"Тында\",\"CountryId\":1193},\"organization\":\"бам\",\"date\":{\"startDate\":\"2016-03-09T00:00:00+03:00\",\"endDate\":\"2016-03-11T00:00:00+03:00\"}}],\"options\":{\"ownExpense\":false}},\"dailyCostsData\":{\"rows\":[{\"index\":1,\"date\":\"2016-03-08T21:00:00.000Z\",\"city\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000},{\"index\":2,\"date\":\"2016-03-09T21:00:00.000Z\",\"city\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000},{\"index\":3,\"date\":\"2016-03-10T21:00:00.000Z\",\"city\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000}],\"options\":{\"entry\":\"2016-03-02T05:21:06.712Z\",\"departure\":\"2016-03-02T05:21:06.712Z\"}},\"ticketRequestsData\":{\"rows\":[{\"index\":1,\"date\":\"2016-03-08T21:00:00.000Z\", \"from\":{\"title\":\"Москва\",\"description\":{\"CountryId\":1193,\"Name\":\"Москва\",\"Id\":650},\"image\":\"\",\"originalObject\":{\"CountryId\":1193,\"Name\":\"Москва\",\"Id\":650},\"hashKey\":\"object:575\"}, \"to\":{\"title\":\"Тында\",\"description\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"image\":\"\",\"originalObject\":{\"CountryId\":1193,\"Name\":\"Тында\",\"Id\":1048},\"hashKey\":\"object:605\"}, \"ticketDescription\":\"71\",\"comment\":\"QQQQQQQQ\"}],\"options\":{\"isNeed\":false}},\"hotelRequestsData\":{\"rows\":[],\"options\":{\"isNeed\":false}},\"trasferRequestsData\":{\"rows\":[],\"options\":{\"isNeed\":false}},\"travelCoordinatorData\":{\"overLimit\":false},\"requestMainData\":{\"number\":11234,\"date\":\"2016-03-02T08:13:06+03:00\",\"tripType\":{\"Name\":\"Служебная поездка\",\"Id\":1},\"tripAim\":{\"Name\":\"Встреча с заказчиком\",\"Id\":1},\"vehicle\":{\"Name\":\"Поезд\",\"Id\":2},\"comment\":\"туту туту\",\"person\":{\"Id\":15,\"Code\":\"01-000001207\",\"FullName\":\"Андреев Антон Александрович\",\"ClockNumber\":\"01-000000В336\",\"Status\":\"active\",\"DepartmentCode\":\"01-ЗП0000526\",\"DepartmentName\":\"Группа по работе с корпоративными приложениями\",\"Email\":\"vladimir.kovalev.mail@gmail.com\",\"UserAccount\":\"test\\\\Anton.Andreev\",\"AssistantId\":null,\"DeputyId\":null,\"ManagerId\":45,\"AssistantName\":null,\"DeputyName\":null,\"ManagerName\":\"Белоусова Александра Игоревна\",\"Manager2NdName\":\"Феоктистов Тимофей Ильич\",\"Manager2NdId\":579,\"DeputyRange\":{\"startDate\":\"0001-01-01T00:00:00+00:00\",\"endDate\":\"0001-01-01T00:00:00+00:00\"},\"Position\":\"Специалист по системе управления взаимоотношениями с клиентами\",\"Costcenter\":\"Отдел инфраструктуры информационных систем\",\"DocumentIssuedBy\":\"Отделом внутренних дел Ленинского района города Иваново\",\"DocumentIssuedOn\":\"2006-02-26T00:00:00Z\",\"DocumentNumber\":\"217625\",\"DocumentSeries\":\"24 05\",\"NumberInternationalPassport\":null,\"ValidityInternationalPassport\":null,\"Organization\":\"ООО ВАЛЕАНТ\",\"Country\":\"Россия\",\"IsAdministrator\":false,\"Roles\":[{\"Id\":1,\"Name\":\"Сотрудник\",\"Code\":\"R-00000001\",\"IsAdministrator\":false}]},\"orderData\":{\"date\":\"2016-03-02T08:13:06+03:00\",\"isApproved\":false}}}}";
            StringReader sr = new StringReader(json);
            Newtonsoft.Json.JsonTextReader reader = new JsonTextReader(sr);

            var ns = new Newtonsoft.Json.JsonSerializerSettings()
            {
                DateParseHandling = DateParseHandling.DateTimeOffset,
                DateFormatHandling  = DateFormatHandling.IsoDateFormat
            };
            var o1 = JsonConvert.DeserializeObject(json);
            var o3 = JsonConvert.DeserializeObject(json, typeof(TripRequestsController.TripRequestDataExRequest), ns);
            Assert.IsNotNull(o3);
        }

        [TestMethod]
        public void TestJSON2()
        {
            string json="{\"action\":\"Создать\",\"data\":{\"date\":\"2016-03-05T17:33:31+03:00\",\"scanPdfsData\":{\"rows\":[],\"options\":{}},\"destinationsData\":{\"rows\":[{\"index\":1,\"country\":{\"IsForeign\":false,\"Name\":\"Россия\",\"Id\":1193},\"city\":{\"Id\":55,\"Name\":\"Анапа\",\"CountryId\":1193},\"date\":{\"startDate\":\"2016-03-28T00:00:00+03:00\",\"endDate\":\"2016-03-31T00:00:00+03:00\"}}],\"options\":{\"ownExpense\":false}},\"dailyCostsData\":{\"rows\":[{\"index\":1,\"date\":\"2016-03-28T21:00:00.000Z\",\"city\":{\"Id\":55,\"Name\":\"Анапа\",\"CountryId\":1193},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000},{\"index\":2,\"date\":\"2016-03-29T21:00:00.000Z\",\"city\":{\"Id\":55,\"Name\":\"Анапа\",\"CountryId\":1193},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000},{\"index\":3,\"date\":\"2016-03-30T21:00:00.000Z\",\"city\":{\"Id\":55,\"Name\":\"Анапа\",\"CountryId\":1193},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000},{\"index\":4,\"date\":\"2016-03-31T21:00:00.000Z\",\"city\":{\"Id\":55,\"Name\":\"Анапа\",\"CountryId\":1193},\"dinner\":false,\"supper\":false,\"baseCost\":1000,\"cost\":1000}],\"options\":{\"entry\":\"2016-03-05T14:43:26.363Z\",\"departure\":\"2016-03-05T14:43:26.363Z\"}},\"ticketRequestsData\":{\"rows\":[{\"index\":1,\"date\":\"2016-03-27T21:00:00.000Z\",\"from\":{\"CountryId\":1193,\"Name\":\"Москва\",\"Id\":650},\"to\":{\"CountryId\":1193,\"Name\":\"Анадырь\",\"Id\":54},\"ticketDescription\":\"2222\"}],\"options\":{\"isNeed\":false}},\"hotelRequestsData\":{\"rows\":[{\"index\":1,\"country\":{\"IsForeign\":false,\"Name\":\"Россия\",\"Id\":1193},\"city\":{\"title\":\"Московский\",\"description\":{\"CountryId\":1193,\"Name\":\"Московский\",\"Id\":651},\"image\":\"\",\"originalObject\":{\"CountryId\":1193,\"Name\":\"Московский\",\"Id\":651},\"$$hashKey\":\"object:485\"},\"hotel\":{\"Name\":\"Транзит\",\"Id\":3},\"startDate\":\"2016-03-28T00:00:00+03:00\",\"endDate\":\"2016-03-31T00:00:00+03:00\",\"hasError\":true}],\"options\":{\"isNeed\":false}},\"trasferRequestsData\":{\"rows\":[{\"index\":1,\"date\":{\"startDate\":\"\",\"endDate\":\"\"},\"from\":\"пре\",\"to\":\"егншщ\"}],\"options\":{\"isNeed\":false}},\"travelCoordinatorData\":{\"overLimit\":false},\"requestMainData\":{\"tripType\":{\"Name\":\"Служебная поездка\",\"Id\":1},\"tripAim\":{\"Name\":\"Встреча с заказчиком\",\"Id\":1},\"vehicle\":{\"Name\":\"Поезд\",\"Id\":2},\"person\":{\"Id\":15,\"Code\":\"01-000001207\",\"FullName\":\"Андреев Антон Александрович\",\"ClockNumber\":\"01-000000В336\",\"Status\":\"active\",\"DepartmentCode\":\"01-ЗП0000526\",\"DepartmentName\":\"Группа по работе с корпоративными приложениями\",\"Email\":\"Anton.Andreev@valeant.com\",\"UserAccount\":\"TEST\\\\Anton.Andreev\",\"AssistantId\":null,\"DeputyId\":null,\"ManagerId\":45,\"AssistantName\":null,\"DeputyName\":null,\"ManagerName\":\"Белоусова Александра Игоревна\",\"Manager2NdName\":\"Феоктистов Тимофей Ильич\",\"Manager2NdId\":579,\"DeputyRange\":{\"startDate\":\"0001-01-01T00:00:00+00:00\",\"endDate\":\"0001-01-01T00:00:00+00:00\"},\"Position\":\"Специалист по системе управления взаимоотношениями с клиентами\",\"Costcenter\":\"Отдел инфраструктуры информационных систем\",\"DocumentIssuedBy\":\"Отделом внутренних дел Ленинского района города Иваново\",\"DocumentIssuedOn\":\"2006-02-26T00:00:00Z\",\"DocumentNumber\":\"217625\",\"DocumentSeries\":\"24 05\",\"NumberInternationalPassport\":null,\"ValidityInternationalPassport\":null,\"Organization\":\"ООО \\\"ВАЛЕАНТ\\\"\",\"Country\":\"Россия\",\"IsAdministrator\":false,\"Roles\":[{\"Id\":1,\"Name\":\"Сотрудник\",\"Code\":\"R-00000001\",\"IsAdministrator\":false}]},\"orderData\":{\"date\":\"2016-03-05T17:33:31+03:00\",\"isApproved\":false}}}}";
            StringReader sr = new StringReader(json);
            Newtonsoft.Json.JsonTextReader reader = new JsonTextReader(sr);

            var ns = new Newtonsoft.Json.JsonSerializerSettings()
            {
                DateParseHandling = DateParseHandling.DateTimeOffset,
                DateFormatHandling  = DateFormatHandling.IsoDateFormat
            };
            var o1 = JsonConvert.DeserializeObject(json);
            var o3 = JsonConvert.DeserializeObject(json, typeof(TripRequestsController.TripRequestDataExRequest), ns);
            Assert.IsNotNull(o3);
        }

        [TestMethod]
        public void TestCountriesList()
        {
            var ctl = new CountriesController();
            var lst1 = ctl.GetAll();
            var js = lst1.Result.Data;
            var lst2 = ((IEnumerable<CountryReference>)js).ToList();
            Assert.IsTrue(lst2[0].Name == "Россия");
        }

    }
}
